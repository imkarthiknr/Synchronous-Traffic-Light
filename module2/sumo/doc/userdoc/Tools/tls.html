<!DOCTYPE html>
<html lang="en">
    <head>
        <meta charset="utf-8">
        <meta http-equiv="X-UA-Compatible" content="IE=edge">
        <meta name="viewport" content="width=device-width, initial-scale=1.0">
        
        <!-- Facebook OpenGraph -->
        <meta property="og:image" content="../images/image-facebook.jpg">
        <meta property="og:image:type" content="image/jpeg">
        <meta property="og:image:width" content="1080">
        <meta property="og:image:height" content="1080">

        
        
        <link rel="canonical" href="https://sumo.dlr.de/docs/Tools/tls.html">
        <link rel="shortcut icon" href="../favicon.ico">
        
        <title>Tools/tls - SUMO Documentation</title>
        <link href="../css/bootstrap.min.css" rel="stylesheet">
        <link href="../css/font-awesome.min.css" rel="stylesheet">
        <link href="../css/base.css" rel="stylesheet">
        <link rel="apple-touch-icon" href="../images/apple-touch-icon.png">
        <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/9.12.0/styles/github.min.css">
        <link href="../extra.css" rel="stylesheet">
        <!-- HTML5 shim and Respond.js IE8 support of HTML5 elements and media queries -->
        <!--[if lt IE 9]>
            <script src="https://oss.maxcdn.com/libs/html5shiv/3.7.0/html5shiv.js"></script>
            <script src="https://oss.maxcdn.com/libs/respond.js/1.4.2/respond.min.js"></script>
        <![endif]-->

        <script src="../js/jquery-1.10.2.min.js" defer></script>
        <script src="../js/bootstrap.min.js" defer></script>
        <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/9.12.0/highlight.min.js"></script>
        <script>hljs.initHighlightingOnLoad();</script> 
    </head>

    <body style="background:#f6f6f6;">

        <div class="navbar fixed-top navbar-expand-lg navbar-dark bg-primary text-center">
            <div class="container-fluid">

                <!-- Collapsed navigation -->
                <div class="navbar-header">
                    <!-- Expander button -->
                    <button type="button" class="navbar-toggler" data-toggle="collapse" data-target="#navbar-collapse">
                        <span class="navbar-toggler-icon"></span>
                    </button>
                </div>

                <!-- Expanded navigation -->
                <div id="navbar-collapse" class="navbar-collapse collapse">
                        <!-- Main navigation -->
                        <ul class="nav navbar-nav">
                            <li class="navitem">
                                <a href="../index.html" class="nav-link">Home</a>
                            </li>
                            <li class="navitem">
                                <a href="../SUMO_User_Documentation.html" class="nav-link">Documentation</a>
                            </li>
                            <li class="navitem">
                                <a href="../Downloads.html" class="nav-link">Downloads</a>
                            </li>
                            <li class="navitem">
                                <a href="../FAQ.html" class="nav-link">FAQ</a>
                            </li>
                            <li class="navitem">
                                <a href="../Contact.html" class="nav-link">Contact</a>
                            </li>
                            <li class="navitem">
                                <a href="../ChangeLog.html" class="nav-link">ChangeLog</a>
                            </li>
                            <li class="navitem">
                                <a href="../Developer/Main.html" class="nav-link">Developer</a>
                            </li>
                            <li class="navitem">
                                <a href="https://github.com/eclipse/sumo/commits/master/docs/web" class="nav-link">Recent Changes</a>
                            </li>
                        </ul>

                    <ul class="nav navbar-nav ml-auto">
                        <li class="nav-item">
                            <a href="#" class="nav-link" data-toggle="modal" data-target="#mkdocs_search_modal">
                                <i class="fa fa-search"></i> <u>S</u>earch
                            </a>
                        </li>
                            <li class="nav-item">
                                <a rel="edit" href="https://github.com/eclipse/sumo/edit/master/docs/web/docs/Tools/tls.md" class="nav-link"><i class="fa fa-github"></i> <u>E</u>dit on GitHub</a>
                            </li>
                      <li class="nav-item dropdown">
                          <a class="nav-link dropdown-toggle" href="#" id="navbardrop" data-toggle="dropdown">
                              <i class="fa fa-chevron-circle-down"></i> More
                          </a>
                          <div class="dropdown-menu dropdown-menu-right">
                            <a class="dropdown-item no-arrow-link" href="https://sumo.dlr.de/sumo_documentation.zip">Download the Documentation</a>
                          </div>
                        </li>
                    </ul>
                </div>
            </div>
        </div>

        <div class="container-fluid">
            <div class="row">
                    <div class="col-md-3">
                        <div class="text-center"><a href="../index.html" style="display: inline-block; margin-top: 5px;"><img src="../images/sumo-logo.png" class="sumoLogo" alt="SUMO Logo" width="120px"></a></div>
                      
<div class="navbar-light navbar-expand-md bs-sidebar hidden-print affix" role="complementary">
    <div class="navbar-header">
        <button type="button" class="navbar-toggler collapsed" data-toggle="collapse" data-target="#toc-collapse" title="Contents">
            <span class="fa fa-angle-down"></span>
        </button>
    </div>

    <div id="toc-collapse" class="navbar-collapse collapse card bg-secondary toc-scroll" style="background-color: #f6f6f6 !important;">
        <ul class="nav flex-column bs-sidenav">
            <p style="margin-top:5px; color:#777777;" class="text-center">Contents</p>
            <li class="nav-item main"><a href="#tlscoordinatorpy">tlsCoordinator.py</a></li>
            <li class="nav-item main"><a href="#tlscycleadaptationpy">tlsCycleAdaptation.py</a></li>
            <li class="nav-item main"><a href="#tls_csv2sumopy">tls_csv2SUMO.py</a></li>
                <li class="nav-item" style="text-indent: 5px;">
                    <a href="#example" class="nav-link">• Example</a>
                </li>
            <li class="nav-item main"><a href="#tls_csvsignalgroupspy">tls_csvSignalGroups.py</a></li>
                <li class="nav-item" style="text-indent: 5px;">
                    <a href="#example_with_a_single_green_phase_per_signal_group" class="nav-link">• Example with a single green phase per signal group</a>
                </li>
                <li class="nav-item" style="text-indent: 5px;">
                    <a href="#example_with_two_green_phases_for_some_groups" class="nav-link">• Example with two green phases for some groups</a>
                </li>
        </ul>
    </div>
</div>
                      </div>
                    <div class="col-md-9" role="main" style="background:white; padding:20px; border-radius:8px; margin-top:5px;">
                        
                            
                            <hTitles>Tools/tls<hr style="border: 0.5px solid #338033; margin-top: 5px !important;"></hTitles>
                            
                        

<h1 id="tlscoordinatorpy">tlsCoordinator.py<a class="headerlink" href="#tlscoordinatorpy" title="Permanent link">#</a></h1>
<p>This script modifies the traffic-light offsets to coordinate them for a
given traffic demand. Example call:</p>
<pre><code>&lt;SUMO_HOME&gt;/tools/tlsCoordinator.py -n net.net.xml -r routes.rou.xml -o tlsOffsets.add.xml
</code></pre>

<p>This would generate the file <em>tlsOffsets.add.xml</em> which can be loaded
into <a href="../SUMO.html">SUMO</a>:</p>
<pre><code>sumo -n net.net.xml -r routes.rou.xml -a tlsOffsets.add.xml
</code></pre>

<div class="admonition note">
<p class="admonition-title">Note</p>
<p>It is advisable to run this with a <em>.net.xml</em> file where all traffic lights have the same cycle time. This is the default since version 0.25.0 but older networks should be rebuilt</p>
</div>
<div class="admonition caution">
<p class="admonition-title">Caution</p>
<p>The route input must contain <code>&lt;vehicle&gt;</code>s with <code>&lt;route&gt;</code>-child-elements. Flows and trips are not supported.</p>
</div>
<h1 id="tlscycleadaptationpy">tlsCycleAdaptation.py<a class="headerlink" href="#tlscycleadaptationpy" title="Permanent link">#</a></h1>
<p>This script modifies the duration of green phases according to Websters
formula to best accomodate a given traffic demand. Example call:</p>
<pre><code>&lt;SUMO_HOME&gt;/tools/tlsCycleAdaptation.py -n net.net.xml -r routes.rou.xml -o newTLS.add.xml
</code></pre>

<p>This would generate the file <em>newTLS.add.xml</em> which can be loaded into
<a href="../SUMO.html">SUMO</a>:</p>
<pre><code>sumo -n net.net.xml -r routes.rou.xml -a newTLS.add.xml
</code></pre>

<div class="admonition caution">
<p class="admonition-title">Caution</p>
<p>The route input must contain <code>&lt;vehicle&gt;</code>s with <code>&lt;route&gt;</code>-child-elements. Flows and trips are not supported.</p>
</div>
<h1 id="tls_csv2sumopy">tls_csv2SUMO.py<a class="headerlink" href="#tls_csv2sumopy" title="Permanent link">#</a></h1>
<p>This tool requires the program definition and the SUMO-network it shall
be converted to:</p>
<pre><code>tls_csv2SUMO.py &lt;TLS_CSV&gt; &lt;NET&gt;
</code></pre>

<p>It prints the generated TLS definition on stdout (you can pipe it to a
file).</p>
<p>The format of the CSV description is as following. At first, three
header lines must be given, which name the tls (which is the id of the
tlLogic in the network), the program's subkey, and the offset at which
the program shall start in seconds - normally 0:</p>
<pre><code>    key;&lt;KEY&gt;
    subkey;&lt;SUBKEY&gt;
    offset;&lt;OFFSET&gt;
</code></pre>

<p>Then, it is defined which signal (number) in the program is responsible
for which link. The link may be described either using the incoming edge
only, or the incoming lane only, or also incorporating the outgoing
edge/lane. This means the following lines are all valid:</p>
<pre><code>    link;&lt;LINK_NUMBER&gt;;&lt;FROM_EDGE&gt;;;0
    link;&lt;LINK_NUMBER&gt;;&lt;FROM_LANE&gt;;;0
    link;&lt;LINK_NUMBER&gt;;&lt;FROM_EDGE&gt;;&lt;TO_EDGE&gt;;0
    link;&lt;LINK_NUMBER&gt;;&lt;FROM_EDGE&gt;;&lt;TO_LANE&gt;;0
    link;&lt;LINK_NUMBER&gt;;&lt;FROM_LANE&gt;;&lt;TO_EDGE&gt;;0
    link;&lt;LINK_NUMBER&gt;;&lt;FROM_LANE&gt;;&lt;TO_LANE&gt;;0
</code></pre>

<p>It is also possible to assign more than one link to a single signal.</p>
<p>Then, the signals' states are given:</p>
<pre><code>&lt;LINK_NUMBER&gt;;&lt;STATES&gt;
</code></pre>

<p>The states are encoded using the signal colors (please note that only
lower-case letters are used, see below) described above, separated by
';'. An example signal phase definition (for signal 1) could be:</p>
<pre><code>1;g;g;g;g;y;r;r;r;r;r
</code></pre>

<p>Please not that the number of states must be the same for all defined
links.</p>
<p>Now, we only have to define the phase times:</p>
<pre><code>time;&lt;TIMES&gt;
</code></pre>

<p>The times are given in seconds, again separated using ';'. An example
could be:</p>
<pre><code>time;18;33;3;6;3;3;9;15;90
</code></pre>

<p>A complete CSV-description could look like:</p>
<pre><code>    key;102
    subkey;utopia
    offset;0
    link;1;4643;;0
    link;1;3078;;0
    link;2;3074;;0
    link;2;-6494;;0
    1;g;g;y;r;r;r;r;r
    2;r;r;r;r;g;g;y;r
    3;r;r;r;r;g;y;y;r
    4;g;y;y;r;r;r;r;r
    min;21;3;3;2;20;9;3;2
    time;45;3;3;2;36;9;3;2
    max;78;3;3;2;62;9;3;2
</code></pre>

<h2 id="example">Example<a class="headerlink" href="#example" title="Permanent link">#</a></h2>
<p>The example shows what is tested in
<a href="http://sourceforge.net/apps/trac/sumo/browser/trunk/sumo/tests/tools/tls/csv2sumo/both_ok">[1]</a>.
It is not a real-world program plan, only a demonstration for using the
script.</p>
<p>We have a simple four-arms intersections which is controlled by traffic
lights, see next figure.</p>
<p><strong>Figure: example intersection</strong></p>
<p><img alt="tls2csv_example_net.svg" src="../images/Tls2csv_example_net.svg" title="tls2csv_example_net.svg" /></p>
<p>Now, we define two different programs for this intersection. The first:</p>
<pre><code>key;0
subkey;own1
offset;0
link;1;4si;3o;0
link;1;4si;1o;0
link;1;3si;4o;0
link;1;3si;2o;0
link;2;4si;4o;0
link;2;4si;2o;0
link;2;3si;1o;0
link;2;3si;3o;0
link;3;1si;1o;0
link;3;1si;4o;0
link;3;2si;2o;0
link;3;2si;3o;0
link;4;1si;3o;0
link;4;1si;2o;0
link;4;2si;1o;0
link;4;2si;4o;0
1;g;y;r;r;r;r;r;r;r;r
2;g;g;g;y;r;r;r;r;r;r
3;r;r;r;r;r;g;y;r;r;r
4;r;r;r;r;r;g;g;g;y;r
min;10;3;5;3;3;10;3;5;3;3
time;15;3;5;3;3;45;3;5;3;3
max;30;3;15;3;3;60;3;15;3;3
</code></pre>

<p>This means that we have four streams: two for north/south (edges 3si and
4si) and two for east/west (edges 1si and 2si). Two, because we give
green longer for the respective left-movers. The key is the ID of the
traffic light ("0"), the subkey is the name of our program ("own1").</p>
<p>The second program looks like this:</p>
<pre><code>key;0
subkey;own2
offset;0
link;1;4si;3o;0
link;1;4si;1o;0
link;1;3si;4o;0
link;1;3si;2o;0
link;2;4si;4o;0
link;2;4si;2o;0
link;2;3si;1o;0
link;2;3si;3o;0
link;3;1si;2o;0
link;3;1si;3o;0
link;3;2si;1o;0
link;3;2si;4o;0
link;4;1si;4o;0
link;4;1si;1o;0
link;4;2si;3o;0
link;4;2si;2o;0
1;g;y;r;r;r;r;r;r
2;g;g;g;y;r;r;r;r
3;r;r;r;r;g;y;r;r
4;r;r;r;r;g;g;g;y
time;31;16;6;16;31;16;6;16
</code></pre>

<p>We convert those program definitions using</p>
<pre><code>tools/tls/tls_csv2SUMO.py lsa_def.csv,lsa_def2.csv input_net.net.xml
</code></pre>

<p>And obtain the following programs after loading them into
<a href="../SUMO-GUI.html">SUMO-GUI</a>:</p>
<p><strong>Figure: converted programs</strong></p>
<p><img alt="program_own1.png" src="../images/Program_own1.png" title="program_own1.png" />
<img alt="program_own2.png" src="../images/Program_own2.png" title="program_own2.png" /></p>
<h1 id="tls_csvsignalgroupspy">tls_csvSignalGroups.py<a class="headerlink" href="#tls_csvsignalgroupspy" title="Permanent link">#</a></h1>
<p>Converts a csv-tls-description into one SUMO can read as additional
file. This tool differs from <strong>tls_csv2SUMO.py</strong> by being based on
signal groups in a way that is closer to the typical representation used
by traffic engineers. It accepts green times per signal group and
creates the <a href="../SUMO.html">SUMO</a> tls representation out of it using
the . Example call to convert two csv-tls-descriptions into the
additional file <em>tls.add.xml</em>:</p>
<pre><code>&lt;SUMO_HOME&gt;/tools/tls/tls_csvSignalgroups.py -n net.net.xml -i tl1.csv,tl2.csv -o tls.add.xml
</code></pre>

<p>In the opposite direction, templates for csv-tls-descriptions of all tls
in a <a href="../SUMO.html">SUMO</a> network can be written to a given directory
and completed by hand:</p>
<pre><code>&lt;SUMO_HOME&gt;/tools/tls/tls_csvSignalgroups.py -n net.net.xml -m .
</code></pre>

<p>The input csv file contains input blocks divided by titles in brackets.
The block [general] sets general information relating to the signal
program like the tls ID, the program ID, the cycle time [s] and the
offset time [s]. Additional 0..n optional parameters can also be
supplied. The [links] block lists the relations between signal groups
and junction connections in <a href="../SUMO.html">SUMO</a>. The relation is
build from the edges/lanes controlled by the respective signal group.
The target edge/lane can be omitted. The last block [signal groups]
contains the table of green times and signal group properties. The table
uses a header row with the following keywords and their meanings:</p>
<table>
<thead>
<tr>
<th>Header</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td>id</td>
<td>signal group id, see block [links]</td>
</tr>
<tr>
<td>on1</td>
<td>start time (signal state green) [s] for the first green time in the cycle</td>
</tr>
<tr>
<td>off1</td>
<td>end time (signal state green) [s] for the first green time in the cycle</td>
</tr>
<tr>
<td>on2</td>
<td>optional start time (signal state green) [s] for the second green time in the cycle</td>
</tr>
<tr>
<td>off2</td>
<td>optional end time (signal state green) [s] for the second green time in the cycle</td>
</tr>
<tr>
<td>transOn</td>
<td>duration [s] for special signal state before green (red-yellow)</td>
</tr>
<tr>
<td>transOff</td>
<td>duration [s] for special signal state after green (yellow)</td>
</tr>
</tbody>
</table>
<p>The keywords may have a different order than shown above. The definition
of a second green time per cycle (keywords <em>on2</em> and <em>off2</em>) is
optional, so are the keywords.</p>
<h2 id="example_with_a_single_green_phase_per_signal_group">Example with a single green phase per signal group<a class="headerlink" href="#example_with_a_single_green_phase_per_signal_group" title="Permanent link">#</a></h2>
<pre><code>[general]
cycle time;60
key;1
subkey;SZP_LeftTurn
offset;0
parameter;key1;value1
parameter;key2;value2
[links]
FZ11;-474_0;
FZ12;-474_1;
FZ21;-472_0;
FZ31;-468_0;
FZ32;-468_1;
FZ41;-470_0;
[signal groups]
id;on1;off1;transOn;transOff
FZ11;0;25;1;3
FZ12;0;35;1;3
FZ21;40;55;1;3
FZ31;0;25;1;3
FZ32;0;35;1;3
FZ41;40;55;1;3
</code></pre>

<h2 id="example_with_two_green_phases_for_some_groups">Example with two green phases for some groups<a class="headerlink" href="#example_with_two_green_phases_for_some_groups" title="Permanent link">#</a></h2>
<pre><code>[general]
cycle time;60
key;1
subkey;SZP_2Green
offset;0
[links]
FZ11;-474_0;
FZ12;-474_1;
FZ21;-472_0;
FZ31;-468_0;
FZ32;-468_1;
FZ41;-470_0;
[signal groups]
id;on1;off1;transOn;transOff;on2;off2
FZ11;0;15;1;3;;
FZ12;0;15;1;3;40;55
FZ21;25;35;1;3;;
FZ31;0;25;1;3;;
FZ32;0;15;1;3;40;55
FZ41;25;35;1;3;;
</code></pre>
                        
                        
                        </div>
            </div>
            
            <button onclick="goTopFunction()" id="goToTop" title="Go to top"><i class="fa fa-arrow-up"></i></button>

        </div>

        <footer class="col-md-12">
          
        <br><small><i>This page was last edited on: 02 September 2019</i></small>
    
            <hr>
                <p>Copyright &copy; 2001 - 2020 German Aerospace Center (DLR) and others.</p>
            <p>Follow us on <a class="no-arrow-link" href="https://www.twitter.com/eclipsesumo/"><i class="fa fa-twitter"></i></a> <a class="no-arrow-link" href="https://www.facebook.com/simulationofurbanmobility/"><i class="fa fa-facebook-square"></i></a>
            | Documentation built with <a href="https://www.mkdocs.org/">MkDocs</a>.</p>
        </footer>

    <div class="modal" id="mkdocs_search_modal" tabindex="-1" role="dialog" aria-labelledby="searchModalLabel" aria-hidden="true">
    <div class="modal-dialog modal-lg">
        <div class="modal-content">
            <div class="modal-header">
                <h4 class="modal-title" id="searchModalLabel">Search</h4>
                <button type="button" class="close" data-dismiss="modal"><span aria-hidden="true">&times;</span><span class="sr-only">Close</span></button>
            </div>
            <div class="modal-body">
                <p>
                    Enter your search terms below.
                </p>
                    <script async src="https://cse.google.com/cse.js?cx=004302551366764109984:1kpgtzrm6kv"></script>
                    <div class="gcse-search"></div>
            </div>
        </div>
    </div>
</div>
      <script>
        window.onscroll = function() {scrollFunction()};
        
        function scrollFunction() {
          if (document.body.scrollTop > 20 || document.documentElement.scrollTop > 20) {
            document.getElementById("goToTop").style.display = "block";
          } else {
            document.getElementById("goToTop").style.display = "none";
          }
        }
    
        function goTopFunction() {
          document.body.scrollTop = 0;
          document.documentElement.scrollTop = 0;
        }
        </script>

        <script>
            var base_url = "..",
                shortcuts = {"help": 191, "search": 83, "edit": 69};
        </script>
        <script src="../js/base.js" defer></script>

        <div class="modal" id="mkdocs_keyboard_modal" tabindex="-1" role="dialog" aria-labelledby="keyboardModalLabel" aria-hidden="true">
    <div class="modal-dialog">
        <div class="modal-content">
            <div class="modal-header">
                <h4 class="modal-title" id="keyboardModalLabel">Keyboard Shortcuts</h4>
                <button type="button" class="close" data-dismiss="modal"><span aria-hidden="true">&times;</span><span class="sr-only">Close</span></button>
            </div>
            <div class="modal-body">
              <table class="table">
                <thead>
                  <tr>
                    <th style="width: 20%;">Key</th>
                    <th>Action</th>
                  </tr>
                </thead>
                <tbody>
                  <tr>
                    <td class="help shortcut"><kbd>?</kbd></td>
                    <td>Open this help</td>
                  </tr>
                  <tr>
                    <td class="search shortcut"><kbd>s</kbd></td>
                    <td>Search</td>
                  </tr>
                  <tr>
                    <td class="edit shortcut"><kbd>e</kbd></td>
                    <td>Edit on GiHub</td>
                  </tr>
                </tbody>
              </table>
            </div>
            <div class="modal-footer">
            </div>
        </div>
    </div>
</div>
    </body>
</html>
